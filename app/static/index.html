<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FX Pricing Service</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); min-height: 100vh; color: #e4e4e4; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        header { display: flex; justify-content: space-between; align-items: center; padding: 20px 0; border-bottom: 1px solid rgba(255,255,255,0.1); margin-bottom: 30px; }
        .logo { display: flex; align-items: center; gap: 12px; }
        .logo-icon { width: 40px; height: 40px; background: linear-gradient(135deg, #00d4aa 0%, #00a885 100%); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 18px; color: #1a1a2e; }
        h1 { font-size: 24px; } h1 span { color: #00d4aa; }
        .status-badge { display: flex; align-items: center; gap: 8px; background: rgba(0, 212, 170, 0.1); padding: 8px 16px; border-radius: 20px; font-size: 14px; }
        .status-dot { width: 8px; height: 8px; background: #00d4aa; border-radius: 50%; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .main-grid { display: grid; grid-template-columns: 400px 1fr; gap: 30px; }
        @media (max-width: 900px) { .main-grid { grid-template-columns: 1fr; } }
        .card { background: rgba(255, 255, 255, 0.05); border-radius: 16px; padding: 24px; border: 1px solid rgba(255, 255, 255, 0.1); }
        .card-title { font-size: 18px; font-weight: 600; margin-bottom: 20px; }
        .form-group { margin-bottom: 16px; }
        label { display: block; font-size: 12px; color: #a0a0a0; margin-bottom: 6px; text-transform: uppercase; }
        input, select { width: 100%; padding: 12px; background: rgba(255, 255, 255, 0.08); border: 1px solid rgba(255, 255, 255, 0.15); border-radius: 8px; color: #fff; font-size: 15px; }
        input:focus, select:focus { outline: none; border-color: #00d4aa; }
        select option { background: #1a1a2e; }
        .btn-primary { width: 100%; padding: 14px; background: linear-gradient(135deg, #00d4aa 0%, #00a885 100%); border: none; border-radius: 8px; color: #1a1a2e; font-size: 16px; font-weight: 600; cursor: pointer; margin-top: 10px; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 10px 30px rgba(0, 212, 170, 0.3); }
        .result { display: none; background: rgba(0, 212, 170, 0.1); border: 1px solid rgba(0, 212, 170, 0.3); border-radius: 12px; padding: 20px; margin-top: 20px; }
        .result.active { display: block; }
        .result-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .result-row:last-child { border: none; font-weight: 600; color: #00d4aa; }
        .rate-big { font-size: 32px; font-weight: 700; color: #00d4aa; text-align: center; padding: 20px 0; }
        .error { background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); color: #f87171; padding: 12px; border-radius: 8px; margin-bottom: 16px; display: none; }
        .error.active { display: block; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 13px; }
        th { color: #a0a0a0; font-size: 11px; text-transform: uppercase; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <div class="logo-icon">FX</div>
                <h1>FX <span>Pricing</span> Service</h1>
            </div>
            <div class="status-badge">
                <div class="status-dot"></div>
                <span id="status">Connecting...</span>
            </div>
        </header>
        <div class="main-grid">
            <div>
                <div class="card">
                    <h2 class="card-title">Get Quote</h2>
                    <div class="error" id="error"></div>
                    <form id="form">
                        <div class="form-group">
                            <label>From Currency</label>
                            <select id="source">
                                <option value="USD">USD - US Dollar</option>
                                <option value="EUR">EUR - Euro</option>
                                <option value="GBP">GBP - British Pound</option>
                                <option value="INR">INR - Indian Rupee</option>
                                <option value="JPY">JPY - Japanese Yen</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>To Currency</label>
                            <select id="target">
                                <option value="INR">INR - Indian Rupee</option>
                                <option value="USD">USD - US Dollar</option>
                                <option value="EUR">EUR - Euro</option>
                                <option value="GBP">GBP - British Pound</option>
                                <option value="JPY">JPY - Japanese Yen</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Amount</label>
                            <input type="number" id="amount" value="100000" min="1">
                        </div>
                        <div class="form-group">
                            <label>Customer Segment</label>
                            <select id="segment">
                                <option value="RETAIL">Retail</option>
                                <option value="SMALL_BUSINESS">Small Business</option>
                                <option value="MID_MARKET" selected>Mid-Market</option>
                                <option value="LARGE_CORPORATE">Large Corporate</option>
                                <option value="PRIVATE_BANKING">Private Banking</option>
                                <option value="INSTITUTIONAL">Institutional</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Customer ID</label>
                            <input type="text" id="custId" value="CUST-001">
                        </div>
                        <button type="submit" class="btn-primary">Get Quote</button>
                    </form>
                    <div class="result" id="result">
                        <div class="rate-big" id="rate">-</div>
                        <div class="result-row"><span>Mid Rate</span><span id="mid">-</span></div>
                        <div class="result-row"><span>Segment Margin</span><span id="segBps">-</span></div>
                        <div class="result-row"><span>Tier Adjustment</span><span id="tierBps">-</span></div>
                        <div class="result-row"><span>Currency Factor</span><span id="ccyBps">-</span></div>
                        <div class="result-row"><span>Total Margin</span><span id="totalBps">-</span></div>
                        <div class="result-row"><span>You Get</span><span id="converted">-</span></div>
                    </div>
                </div>
            </div>
            <div class="card">
                <h2 class="card-title">Pricing Reference</h2>
                <h3 style="margin: 15px 0 10px; font-size: 14px; color: #a0a0a0;">Customer Segments</h3>
                <table id="segTable"><tr><td>Loading...</td></tr></table>
                <h3 style="margin: 20px 0 10px; font-size: 14px; color: #a0a0a0;">Amount Tiers</h3>
                <table id="tierTable"><tr><td>Loading...</td></tr></table>
            </div>
        </div>
    </div>
    <script>
        const API = 'http://localhost:8000/api/v1/fx/pricing';
        
        fetch(`${API}/health`).then(r => r.json()).then(d => {
            document.getElementById('status').textContent = d.status === 'healthy' ? 'Live' : 'Offline';
        }).catch(() => document.getElementById('status').textContent = 'Offline');

        fetch(`${API}/segments`).then(r => r.json()).then(data => {
            document.getElementById('segTable').innerHTML = `<tr><th>Segment</th><th>Base</th><th>Range</th></tr>` +
                data.map(s => `<tr><td>${s.segment_name}</td><td>${s.base_margin_bps} bps</td><td>${s.min_margin_bps}-${s.max_margin_bps}</td></tr>`).join('');
        });

        fetch(`${API}/tiers`).then(r => r.json()).then(data => {
            document.getElementById('tierTable').innerHTML = `<tr><th>Tier</th><th>Range</th><th>Adj</th></tr>` +
                data.map(t => `<tr><td>${t.tier_id}</td><td>$${t.min_amount.toLocaleString()} - ${t.max_amount ? '$'+t.max_amount.toLocaleString() : 'âˆž'}</td><td>${t.adjustment_bps > 0 ? '+' : ''}${t.adjustment_bps} bps</td></tr>`).join('');
        });

        document.getElementById('form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const err = document.getElementById('error');
            err.classList.remove('active');
            try {
                const res = await fetch(`${API}/quote`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        source_currency: document.getElementById('source').value,
                        target_currency: document.getElementById('target').value,
                        amount: parseFloat(document.getElementById('amount').value),
                        customer_id: document.getElementById('custId').value,
                        segment: document.getElementById('segment').value,
                        direction: 'SELL'
                    })
                });
                if (!res.ok) throw new Error('Quote failed');
                const q = await res.json();
                document.getElementById('result').classList.add('active');
                document.getElementById('rate').textContent = q.customer_rate.toFixed(4);
                document.getElementById('mid').textContent = q.mid_rate.toFixed(4);
                document.getElementById('segBps').textContent = `+${q.margin_breakdown.segment_base_bps} bps`;
                document.getElementById('tierBps').textContent = `${q.margin_breakdown.tier_adjustment_bps >= 0 ? '+' : ''}${q.margin_breakdown.tier_adjustment_bps} bps`;
                document.getElementById('ccyBps').textContent = `+${q.margin_breakdown.currency_factor_bps} bps`;
                document.getElementById('totalBps').textContent = `${q.margin_bps} bps (${q.margin_percent.toFixed(2)}%)`;
                document.getElementById('converted').textContent = `${q.target_currency} ${q.target_amount.toLocaleString()}`;
            } catch (error) {
                err.textContent = error.message;
                err.classList.add('active');
            }
        });
    </script>
</body>
</html>
